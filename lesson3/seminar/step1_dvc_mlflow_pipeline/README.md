# Шаг 1: DVC + MLflow пайплайн с инкрементальными данными

## Описание

Этот шаг демонстрирует создание ML пайплайна с использованием DVC для управления данными и экспериментами, и MLflow для логирования моделей и метрик. Основная особенность - работа с инкрементальными данными, имитирующими поступление новых данных с продакшена.

## Структура

```
step1_dvc_mlflow_pipeline/
├── data/
│   ├── raw/           # Исходные данные
│   └── processed/     # Обработанные данные по версиям
├── models/            # Сохраненные модели
├── metrics/           # Метрики модели
├── src/              # Исходный код
└── dvc.yaml          # Описание пайплайна DVC
```

## Установка и настройка

1. Установка зависимостей:
```bash
poetry install
```

2. Активация виртуального окружения:
```bash
poetry shell
```

3. Инициализация DVC:
```bash
dvc init --no-scm
```

4. Запуск MLflow UI (в отдельном терминале):
```bash
mlflow ui --host 0.0.0.0 --port 5000
```

## Использование

### Обучение первой модели (базовая версия)

```bash
# Загрузка исходных данных
dvc repro get_data

# Подготовка первого батча (первые 50 записей)
dvc repro -s prepare_batch --vars batch_number=1

# Объединение данных (пока только один батч)
dvc repro -s merge_data --vars batch_number=1

# Предобработка данных
dvc repro -s preprocess --vars batch_number=1

# Обучение модели
dvc repro -s train --vars batch_number=1

# Оценка модели
dvc repro -s evaluate --vars batch_number=1
```

### Добавление новых данных и переобучение

```bash
# Подготовка второго батча (записи 51-100)
dvc repro -s prepare_batch --vars batch_number=2

# Объединение с предыдущими данными
dvc repro -s merge_data --vars batch_number=2

# Предобработка объединенных данных
dvc repro -s preprocess --vars batch_number=2

# Переобучение модели на расширенных данных
dvc repro -s train --vars batch_number=2

# Оценка новой модели
dvc repro -s evaluate --vars batch_number=2
```

### Автоматический пайплайн для батча

Можно выполнить весь пайплайн для конкретного батча одной командой:

```bash
# Полный пайплайн для батча 3
dvc repro --vars batch_number=3
```

## Мониторинг

1. **MLflow UI**: Открыть http://localhost:5000 для просмотра экспериментов и моделей

2. **Метрики**: Файлы метрик сохраняются в папке `metrics/`

3. **Версионирование**: DVC отслеживает версии данных и моделей

## Демонстрация инкрементального обучения

Этот пайплайн показывает, как:

1. **Добавлять новые данные**: Каждый батч представляет новую порцию данных
2. **Объединять с историческими данными**: Все предыдущие батчи объединяются
3. **Переобучать модель**: Модель обучается на все больших объемах данных
4. **Сравнивать производительность**: MLflow позволяет сравнивать метрики разных версий
5. **Версионировать все артефакты**: DVC отслеживает данные, модели и метрики

Такой подход типичен для продакшен ML систем, где модель периодически дообучается на новых данных.
